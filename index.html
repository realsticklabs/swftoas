<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zlib Decompression Example for SWF Files</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.11/pako.min.js"></script>
</head>
<body>
    <h1>Zlib Decompression Example for SWF Files</h1>
    
    <!-- File input and button -->
    <input type="file" id="fileInput" accept=".swf" />
    <button id="decompressButton">Decompress SWF File</button>
    <button id="saveButton" style="display: none;">Save as FLA</button>
    
    <pre id="output"></pre>

    <script>
        let decompressedData;

        document.getElementById('decompressButton').addEventListener('click', function() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const arrayBuffer = event.target.result;
                        const byteArray = new Uint8Array(arrayBuffer);

                        const header = String.fromCharCode.apply(null, byteArray.slice(0, 3));
                        if (header === "CWS") {
                            const compressedByteArray = byteArray.slice(8);
                            decompressedData = pako.inflate(compressedByteArray);
                        } else if (header === "FWS") {
                            document.getElementById('output').textContent = 'The SWF file is not compressed.';
                            return;
                        } else {
                            document.getElementById('output').textContent = 'Invalid SWF file.';
                            return;
                        }

                        const originalData = new TextDecoder('utf-8').decode(decompressedData);
                        console.log('Decompressed Data:', originalData);
                        document.getElementById('output').textContent = 'Decompressed Data: ' + originalData;

                        // Show the save button
                        document.getElementById('saveButton').style.display = 'inline-block';

                    } catch (err) {
                        console.error('Decompression failed:', err);
                        document.getElementById('output').textContent = 'Decompression failed: ' + err.message;
                    }
                };

                reader.readAsArrayBuffer(file);
            } else {
                alert('Please select a SWF file to decompress.');
            }
        });

        document.getElementById('saveButton').addEventListener('click', function() {
            if (decompressedData) {
                const blob = new Blob([decompressedData], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'output.fla';  // Set the name of the file
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url); // Clean up
            } else {
                alert('No decompressed data available to save.');
            }
        });
    </script>
</body>
</html>
